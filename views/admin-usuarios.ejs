<div class="bg-white rounded-lg shadow p-6 overflow-x-auto">

    <a href="/admin/usuarios/nuevo" 
       class="text-white px-4 py-2 rounded mb-4 inline-block"
       style="background-color:#d17a00;"
       onmouseover="this.style.backgroundColor='#b86500'" 
       onmouseout="this.style.backgroundColor='#d17a00'">
       Agregar Usuario
    </a>

    <table id="usuariosTable" class="min-w-full table-auto border-collapse display">
        <thead>
            <tr class="bg-[#D17A08] text-white">
                <th class="px-4 py-2 text-left">ID</th>
                <th class="px-4 py-2 text-left">Nombre</th>
                <th class="px-4 py-2 text-left">Apellido</th>
                <th class="px-4 py-2 text-left">Rol</th>
                <th class="px-4 py-2 text-left">Acciones</th>
            </tr>
        </thead>

        <tbody>
            <% usuarios.forEach(usuario=> { %>
                <tr class="border-b">
                    <td class="px-4 py-2" oncontextmenu="mostrarAlerta(event, this)" ><%= usuario.id %></td>
                    <td class="px-4 py-2"><%= usuario.nombre %></td>
                    <td class="px-4 py-2"><%= usuario.apellido %></td>
                    <td class="px-4 py-2">
                        <%= usuario.rol==="API" ? "Apicultor" : "Administrador" %>
                    </td>
                    <td class="px-4 py-2 flex gap-2">
                        <a href="/admin/usuarios/editar/<%= usuario.id %>" 
                           class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">
                           Editar
                        </a>
                        <% if (usuario.rol==="API" ) { %>
                            <a href="/admin/usuarios/eliminar/<%= usuario.id.trim() %>" 
                               class="btn-eliminar bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">
                               Eliminar
                            </a>
                        <% } else { %>
                            <span class="bg-red-400 text-white px-3 py-1 rounded opacity-50 cursor-not-allowed">Eliminar</span>
                        <% } %>
                    </td>
                </tr>
            <% }); %>
        </tbody>
    </table>
</div>

<!-- Librería SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $(document).ready(function() {
        // Inicializar DataTable
        $('#usuariosTable').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            info: true,
            responsive: true,
            language: {
                "emptyTable": "No hay datos disponibles en la tabla",
                "info": "Mostrando _START_ a _END_ de _TOTAL_ registros",
                "infoEmpty": "Mostrando 0 a 0 de 0 registros",
                "infoFiltered": "(filtrado de _MAX_ registros totales)",
                "lengthMenu": "Mostrar _MENU_ registros",
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "Buscar:",
                "zeroRecords": "No se encontraron registros coincidentes",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
                "aria": {
                    "sortAscending": ": activar para ordenar la columna ascendente",
                    "sortDescending": ": activar para ordenar la columna descendente"
                }
            }
        });

        // Confirmación al eliminar
        $(document).on("click", ".btn-eliminar", function(e) {
            e.preventDefault(); 
            const url = $(this).attr("href");

            Swal.fire({
                title: "¿Estás seguro?",
                text: "¡No podrás revertir esto!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Sí, eliminarlo"
            }).then((result) => {
                if (result.isConfirmed) {
                    // Redirige al backend
                    window.location.href = url;
                }
            });
        });

        // Mostrar alertas según query params
        const urlParams = new URLSearchParams(window.location.search);

        if (urlParams.get("deleted") === "1") {
            Swal.fire({
                title: "¡Eliminado!",
                text: "El usuario ha sido eliminado correctamente.",
                icon: "success",
                confirmButtonColor: "#3085d6"
            });
        }

        if (urlParams.get("error") === "db") {
            Swal.fire({
                title: "Error en la Base de Datos",
                text: "Ocurrió un problema al eliminar el usuario.",
                icon: "error",
                confirmButtonColor: "#d33"
            });
        }

        if (urlParams.get("error") === "notfound") {
            Swal.fire({
                title: "Usuario no encontrado",
                text: "El usuario que intentas eliminar no existe.",
                icon: "warning",
                confirmButtonColor: "#d33"
            });
        }
    });
</script>
 <script>
    function mostrarAlerta(event, celda) {
      event.preventDefault(); // evita menú del navegador
      
      window.location.href = "/admin/nodos/" + celda.textContent.trim();

      
    }
  </script>