<div class="bg-white rounded-lg shadow p-6 max-w-md mx-auto">
  <!-- Título -->
  <div class="flex items-center mb-4">
    <i class="fas fa-user-edit text-[#D17A08] text-2xl mr-2"></i>
    <h2 class="text-xl font-bold text-gray-700">Editar usuario</h2>
  </div>

  <form method="POST" autocomplete="off" id="formulario_actualizacion" >
    <!-- ID -->
    <div class="mb-4">
      <label class="block text-sm font-semibold text-gray-700 mb-1">ID</label>
      <input type="text" name="id" id="id" value="<%= usuario.id %>" readonly
        class="w-full rounded-md border border-gray-300 bg-gray-100 px-3 py-2 focus:outline-none" />
    </div>

    <!-- Nombres -->
    <div class="mb-4">
      <label class="block text-sm font-semibold text-gray-700 mb-1">Nombres</label>
      <input type="text" name="nombres" id="nombres" value="<%= usuario.nombre %>"
        class="w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 
               focus:outline-none focus:ring-2 focus:ring-[#D17A08] focus:border-[#D17A08]" />
    </div>

    <!-- Apellidos -->
    <div class="mb-4">
      <label class="block text-sm font-semibold text-gray-700 mb-1">Apellidos</label>
      <input type="text" name="apellidos" id="apellidos" value="<%= usuario.apellido %>"
        class="w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 
               focus:outline-none focus:ring-2 focus:ring-[#D17A08] focus:border-[#D17A08]" />
    </div>

    <!-- Comuna -->
    <div class="mb-4">
      <label class="block text-sm font-semibold text-gray-700 mb-1">Comuna</label>
      <input type="text" name="comuna" id="comuna" value="<%= usuario.comuna %>"
        class="w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 
               focus:outline-none focus:ring-2 focus:ring-[#D17A08] focus:border-[#D17A08]" />
    </div>

    <!-- Rol -->
    <div class="mb-4">
      <label class="block text-sm font-semibold text-gray-700 mb-1">Rol</label>
      <select name="rol" id="rol" 
        class="w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 
               focus:outline-none focus:ring-2 focus:ring-[#D17A08] focus:border-[#D17A08]">
        <option value="API" <%= usuario.rol === 'API' ? 'selected' : '' %>>API | APICULTOR</option>
        <option value="ADM" <%= usuario.rol === 'ADM' ? 'selected' : '' %>>ADM | ADMINISTRADOR</option>
      </select>
    </div>

    <!-- Estado -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-1">Estado</label>
      <select name="estado"  id="estado"
        class="w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 
               focus:outline-none focus:ring-2 focus:ring-[#D17A08] focus:border-[#D17A08]">
        <option value="1" <%= usuario.activo == 1 ? 'selected' : '' %>>Activo</option>
        <option value="0" <%= usuario.activo == 0 ? 'selected' : '' %>>Inactivo</option>
      </select>
    </div>

    <!-- Botones -->
    <div class="flex space-x-3">
      <button type="submit"
        class="flex items-center gap-2 bg-[#D17A08] text-white px-4 py-2 rounded-md shadow hover:bg-[#b96907] transition">
        <i class="fas fa-save"></i> Guardar cambios
      </button>
      <a href="/admin/usuarios"
        class="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-md shadow hover:bg-red-700 transition">
     Volver
      </a>
    </div>
  </form>
</div>



<script>

const formulario = document.getElementById('formulario_actualizacion');
formulario.addEventListener('submit', function(event) {
    event.preventDefault(); // Evita el envío del formulario por defecto

    // Obtiene los valores de los campos
    const id = document.getElementById('id').value;
    const nombres = document.getElementById('nombres').value;
    const apellidos = document.getElementById('apellidos').value;
    const comuna = document.getElementById('comuna').value;
    const rol = document.getElementById('rol').value;
    const estado = document.getElementById('estado').value;


    if (!id || !nombres || !apellidos || !rol || !estado || !comuna) {
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'Por favor, completa todos los campos.',
            confirmButtonColor: '#d33'
        });
        return;
    
    }else{

        Swal.fire({
  title: "Estas seguro?",
  text: "Podras editar este usuario mas tarde.",
  icon: "warning",
  showCancelButton: true,
  confirmButtonColor: "#3085d6",
  cancelButtonColor: "#d33",
  confirmButtonText: "Si, Guardar!"
}).then((result) => {
  if (result.isConfirmed) {


                 
     const url = "/admin/usuarios/editar/" + id;

     const usuario = {
        id: id,
        nombres: nombres,
        apellidos: apellidos,
        comuna: comuna,
        rol: rol,
        estado: estado
     }


     fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(usuario)
        }).then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error('Error en la solicitud');
            }
        }).then(data => {
            if (data.success) {
                Swal.fire({
                    title: "Muy bien!",
                    text: "Usuario actualizado correctamente!",
                    icon: "success"
                })
            } else {
                Swal.fire({
                    title: "Error",
                    text: data.message || "No se pudo actualizar el usuario.",
                    icon: "error"
                });
            }
        }).catch(error => {
            Swal.fire({
                title: "Error",
                text: error.message,
                icon: "error"
            });
        });

  }
});

    }




    
});



</script>